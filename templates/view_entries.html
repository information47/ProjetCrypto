<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Entrées de Mot de Passe</title>
    <link
      href="{{ url_for('static', filename='css/password_entries.css') }}"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <h2>Entrées de Mot de Passe pour : {{ coffre.nom_coffre }}</h2>

      <h3>Vos Entrées de Mot de Passe</h3>
      <table class="entries-table">
        <thead>
          <tr>
            <th>Nom</th>
            <th>Login</th>
            <th>URL</th>
            <th>Mot de Passe</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for entry in entries %}
          <tr>
            <td>{{ entry.name }}</td>
            <td>{{ entry.login }}</td>
            <td>
              <a href="{{ entry.url }}" target="_blank">{{ entry.url }}</a>
            </td>
            <td>{{ entry.password }}</td>
            <td>
              <form
                method="post"
                action="{{ url_for('delete_password_entry', password_entry_id=entry.Id_PasswordEntry, coffre_id=coffre.Id_coffre) }}"
              >
                <button id="simpleButton" type="submit">supprimer</button>
              </form>
              <!-- Bouton "Modifier" dans le tableau -->
              <button onclick="openModal('{{ entry.Id_PasswordEntry }}')">Modifier</button>

              <!-- Fenêtre modale -->
              <div id="modal-{{ entry.Id_PasswordEntry }}" class="modal">
                <div class="modal-content">
                  <span class="close" onclick="closeModal('{{ entry.Id_PasswordEntry }}')">&times;</span>
                  <form
                    method="post"
                    action="{{ url_for('update_password_entry', password_entry_id=entry.Id_PasswordEntry, coffre_id=coffre.Id_coffre) }}"
                  >
                    <h3>Modifier l'entrée</h3>
                    <input type="text" name="login" placeholder="Login" value="{{ entry.login }}" required>
                    <input type="password" name="password" placeholder="Mot de passe" value="{{ entry.password }}" required>
                    <input type="text" name="url" placeholder="URL" value="{{ entry.url }}">
                    <input type="text" name="name" placeholder="Nom" value="{{ entry.name }}" required>
                    <button type="submit">Valider</button>
                  </form>
                </div>
              </div>
          </tr>
          {% else %}
          <tr>
            <td colspan="4">Aucune entrée de mot de passe trouvée.</td>
            <td></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <h3>Ajouter une Entrée de Mot de Passe</h3>
      <form
        method="post"
        action="{{ url_for('add_password_entry', coffre_id=coffre.Id_coffre) }}"
      >
        <label for="name">Nom:</label>
        <input type="text" id="name" name="name" required />
        <br />
        <label for="login">Login:</label>
        <input type="text" id="login" name="login" required />
        <br />
        <label for="url">URL:</label>
        <input type="url" id="url" name="url" required />
        <br />
        <label for="password">Mot de passe:</label>
        <input type="password" id="password" name="password" required />
        <br />
        <button type="submit">Ajouter Entrée</button>
      </form>

      <a href="{{ url_for('dashboard') }}">Retourner au tableau de bord</a>

      <div class="messages">
        {% with messages = get_flashed_messages(with_categories=true) %} {% if
        messages %}
        <ul>
          {% for category, message in messages %}
          <li class="{{ category }}">{{ message }}</li>
          {% endfor %}
        </ul>
        {% endif %} {% endwith %}
      </div>
    </div>

    <script>
      window.addEventListener("pageshow", function (event) {
        if (event.persisted) {
          window.location.reload();
        }
      });
    </script>
  </body>
</html>

<!-- CSS pour la fenêtre modale -->
<style>
  .modal {
    display: none; /* Masqué par défaut */
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto; /* Permet de scroller si le contenu dépasse */
    background-color: rgba(0, 0, 0, 0.5); /* Fond semi-transparent */
  }

  .modal-content {
    background-color: white;
    margin: 15% auto; /* Centrer verticalement */
    padding: 20px;
    border: 1px solid #888;
    width: 50%; /* Taille de la fenêtre modale */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    border-radius: 8px;
  }

  .close {
    color: black;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }

  .close:hover,
  .close:focus {
    color: red;
    text-decoration: none;
    cursor: pointer;
  }
</style>

<script>
  function openModal(entryId) {
    // Affiche la fenêtre modale
    const modal = document.getElementById(`modal-${entryId}`);
    modal.style.display = "block";
  }

  function closeModal(entryId) {
    // Cache la fenêtre modale
    const modal = document.getElementById(`modal-${entryId}`);
    modal.style.display = "none";
  }

  // Fermer la modale si on clique en dehors du contenu
  window.onclick = function (event) {
    const modals = document.querySelectorAll('.modal');
    modals.forEach((modal) => {
      if (event.target === modal) {
        modal.style.display = "none";
      }
    });
  };
</script>